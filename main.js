(()=>{"use strict";class e{constructor(e){this.length=e,this.ship=this.createShip()}getShip(){return this.ship}getShipLength(){return this.ship.length}createShip(){let e=[];for(let t=0;t<this.length;t++)e.push({hit:!1});return e}hit(e){this.ship[e].hit=!0}checkHit(e){return!!e.hit}isSunk(){return this.ship.every(this.checkHit)}}const t=document.getElementById("player-ships"),i=document.getElementById("carrier"),a=document.getElementById("battleship"),r=document.getElementById("cruiser"),s=document.getElementById("submarine"),n=document.getElementById("destroyer"),h=document.getElementById("ai-side");function c(e){e.addEventListener("dragstart",(e=>{e.dataTransfer.setData("text/plain",e.target.id)}))}c(i),c(a),c(r),c(s),c(n);const d=new class{constructor(){this.board=this.createBoard(),this.missedAttacks=[]}getGameboard(){return this.board}getMissedAttacks(){return this.missedAttacks}createBoard(){let e=[],t=[];for(let i=0;i<10;i++){for(let e=0;e<10;e++)t.push({shipName:void 0,shipIndex:void 0});e.push(t),t=[]}return e}checkValidShipPlacement(e,t,i){if(t>10||t<0||i>10||i<0||i+e>10)return!1;for(let a=i;a<i+e;a++)if(void 0!==this.board[a][t].shipName)return!1;return!0}placeShip(e,t,i){if(this.checkValidShipPlacement(e.getShipLength(),t,i)){for(let a=0;a<e.getShipLength();a++)this.board[i+a][t].shipName=e,this.board[i+a][t].shipIndex=a;return!0}return!1}receiveAttack(e,t){this.board[t][e].shipName?this.board[t][e].shipName.hit(this.board[t][e].shipIndex):this.missedAttacks.push({x:e,y:t})}checkAllShipSunk(){let e=!0;return this.board.forEach((t=>{t.forEach((t=>{t.shipName&&(t.shipName.isSunk()||(e=!1))}))})),e}},l=(new class{constructor(){this.name="",this.turn=!0}setName(e){this.name=e}startTurn(){!1===this.turn&&(this.turn=!0)}endTurn(e){!0===this.turn&&(this.turn=!1,e.startTurn())}attack(e,t,i,a){this.turn&&(t.receiveAttack(i,a),this.endTurn(e))}}(""),new e(5)),o=new e(4),u=new e(3),p=new e(3),m=new e(2);function g(e){let i=e.dataTransfer.getData("text"),a=parseInt(e.target.getAttribute("data-x")),r=parseInt(e.target.getAttribute("data-y"));switch(i){case"carrier":if(d.checkValidShipPlacement(l.getShipLength(),a,r)){d.placeShip(l,a,r);let e=document.querySelector(`#${i}`);t.removeChild(e),S(d,"player-board"),t.childNodes.length<=9&&y()}break;case"battleship":if(d.checkValidShipPlacement(o.getShipLength(),a,r)){d.placeShip(o,a,r);let e=document.querySelector(`#${i}`);t.removeChild(e),S(d,"player-board"),t.childNodes.length<=9&&y()}break;case"cruiser":if(d.checkValidShipPlacement(u.getShipLength(),a,r)){d.placeShip(u,a,r);let e=document.querySelector(`#${i}`);t.removeChild(e),S(d,"player-board"),t.childNodes.length<=9&&y()}break;case"submarine":if(d.checkValidShipPlacement(p.getShipLength(),a,r)){d.placeShip(p,a,r);let e=document.querySelector(`#${i}`);t.removeChild(e),S(d,"player-board"),t.childNodes.length<=9&&y()}break;case"destroyer":if(d.checkValidShipPlacement(m.getShipLength(),a,r)){d.placeShip(m,a,r);let e=document.querySelector(`#${i}`);t.removeChild(e),S(d,"player-board"),t.childNodes.length<=9&&y()}}}function y(){const e=document.getElementById("game-container");t.style.display="none",h.classList.remove("hide-ai-side"),e.classList.remove("intial-layout"),e.classList.add("game-layout")}function S(e,t){let i=e.getGameboard(),a=e.getMissedAttacks();i.forEach(((e,i)=>{e.forEach(((e,a)=>{if(e.shipName)if(e.shipName.checkHit(e.shipName.getShip()[e.shipIndex])){let e=document.querySelector(`.${t} [data-x="${a}"][data-y="${i}"]`);e.classList.add("hit"),e.classList.remove("occupied"),e.textContent="X"}else"player-board"===t&&document.querySelector(`.${t} [data-x="${a}"][data-y="${i}"]`).classList.add("occupied")}))})),a.forEach((e=>{let i=document.querySelector(`.${t} [data-x="${e.x}"][data-y="${e.y}"]`);i.classList.add("missed"),i.textContent="-"}))}new e(5),new e(4),new e(3),new e(3),new e(2),function(e){const t=document.getElementById(`${e}`);for(let e=0;e<10;e++)for(let i=0;i<10;i++){let a=document.createElement("div");a.classList.add("cell"),a.setAttribute("data-x",i),a.setAttribute("data-y",e),a.addEventListener("dragover",(e=>e.preventDefault())),a.addEventListener("drop",(e=>{e.preventDefault(),g(e)})),t.appendChild(a)}}("player-board"),S(d,"player-board")})();