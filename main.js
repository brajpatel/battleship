(()=>{"use strict";class t{constructor(t){this.length=t,this.ship=this.createShip()}getShip(){return this.ship}getShipLength(){return this.ship.length}createShip(){let t=[];for(let e=0;e<this.length;e++)t.push({hit:!1});return t}hit(t){this.ship[t].hit=!0}checkHit(t){return!!t.hit}isSunk(){return this.ship.every(this.checkHit)}}const e=document.getElementById("player-ships"),r=document.getElementById("carrier"),a=document.getElementById("battleship"),i=document.getElementById("cruiser"),s=document.getElementById("submarine"),n=document.getElementById("destroyer");function h(t){t.addEventListener("dragstart",(t=>{t.dataTransfer.setData("text/plain",t.target.id)}))}h(r),h(a),h(i),h(s),h(n);const d=new class{constructor(){this.board=this.createBoard(),this.missedAttacks=[]}getGameboard(){return this.board}getMissedAttacks(){return this.missedAttacks}createBoard(){let t=[],e=[];for(let r=0;r<10;r++){for(let t=0;t<10;t++)e.push({shipName:void 0,shipIndex:void 0});t.push(e),e=[]}return t}checkValidShipPlacement(t,e,r){if(e>10||e<0||r>10||r<0||r+t>10)return!1;for(let a=r;a<r+t;a++)if(void 0!==this.board[a][e].shipName)return!1;return!0}placeShip(t,e,r){if(this.checkValidShipPlacement(t.getShipLength(),e,r)){for(let a=0;a<t.getShipLength();a++)this.board[r+a][e].shipName=t,this.board[r+a][e].shipIndex=a;return!0}return!1}receiveAttack(t,e){this.board[e][t].shipName?this.board[e][t].shipName.hit(this.board[e][t].shipIndex):this.missedAttacks.push({x:t,y:e})}checkAllShipSunk(){let t=!0;return this.board.forEach((e=>{e.forEach((e=>{e.shipName&&(e.shipName.isSunk()||(t=!1))}))})),t}},c=(new class{constructor(){this.name="",this.turn=!0}setName(t){this.name=t}startTurn(){!1===this.turn&&(this.turn=!0)}endTurn(t){!0===this.turn&&(this.turn=!1,t.startTurn())}attack(t,e,r,a){this.turn&&(e.receiveAttack(r,a),this.endTurn(t))}}(""),new t(5));function o(t){let r=t.dataTransfer.getData("text"),a=parseInt(t.target.getAttribute("data-x")),i=parseInt(t.target.getAttribute("data-y"));if("carrier"===r&&d.checkValidShipPlacement(c.getShipLength(),a,i)){d.placeShip(c,a,i);let t=document.querySelector(`#${r}`);e.removeChild(t),l(d,"player-board"),e.childNodes.length<=6&&(e.style.display="none")}}function l(t,e){let r=t.getGameboard(),a=t.getMissedAttacks();r.forEach(((t,r)=>{t.forEach(((t,a)=>{if(t.shipName)if(t.shipName.checkHit(t.shipName.getShip()[t.shipIndex])){let t=document.querySelector(`.${e} [data-x="${a}"][data-y="${r}"]`);t.classList.add("hit"),t.classList.remove("occupied"),t.textContent="X"}else"player-board"===e&&document.querySelector(`.${e} [data-x="${a}"][data-y="${r}"]`).classList.add("occupied")}))})),a.forEach((t=>{let r=document.querySelector(`.${e} [data-x="${t.x}"][data-y="${t.y}"]`);r.classList.add("missed"),r.textContent="-"}))}new t(4),new t(3),new t(3),new t(2),new t(5),new t(4),new t(3),new t(3),new t(2),function(t){const e=document.getElementById(`${t}`);for(let t=0;t<10;t++)for(let r=0;r<10;r++){let a=document.createElement("div");a.classList.add("cell"),a.setAttribute("data-x",r),a.setAttribute("data-y",t),a.addEventListener("dragover",(t=>t.preventDefault())),a.addEventListener("drop",(t=>{t.preventDefault(),o(t)})),e.appendChild(a)}}("player-board"),l(d,"player-board")})();